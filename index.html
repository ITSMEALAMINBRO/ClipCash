<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>ЁЭЧХЁЭЧ╝ЁЭЧ╝ЁЭШБЁЭЧШЁЭЧлЁЯе╛</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />
  <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@600&display=swap" rel="stylesheet">
  
  
  
  <link rel="stylesheet" href="style.css">
</head>
<body>

    <div id="app-loader">
      <div id="bootex-loader">
        <div id="lottie-box"></div>
        <div class="loader-title">BootEX <span>ЁЯе╛</span></div>
        <p id="loader-text">Preparing BootEXтАж</p>
      </div>
      <div id="fallback-bounce" aria-hidden="true">
        <div class="boot-icon">ЁЯе╛</div>
        <div class="loader-title">BootEX</div>
        <p class="hint">Getting things readyтАж</p>
      </div>
    </div>

    <div id="popup" class="popup-overlay"><div class="popup-content"><div id="popup-body"></div></div></div>
    <div id="app" style="display: none;">
    
    <header class="profile-header elegant-header d-flex align-items-center p-3 bg-white rounded shadow-sm">

  <!-- ржЗржЙржЬрж╛рж░рзЗрж░ ржкрзНрж░рзЛржлрж╛ржЗрж▓ ржЫржмрж┐ -->
  <img id="user-photo" src="https://via.placeholder.com/60" alt="User" class="profile-photo me-3">

  <!-- ржЗржЙржЬрж╛рж░рзЗрж░ ржирж╛ржо ржУ ржмрзНржпрж╛рж▓рж╛ржирзНрж╕ -->
  <div class="user-info flex-grow-1">
    <div class="name-line d-flex align-items-center">
      <h1 id="user-name" class="me-2 mb-0 fs-4 fw-semibold">Loading...</h1>

      <!-- ржнрзЗрж░рж┐ржлрж╛ржЗ ржЗржорзЗржЬ -->
      <img src="https://trickbd.com/wp-content/uploads/2025/10/27/IMG_20251027_222438-removebg-preview.png" alt="verified" class="verify-img">
    </div>

    <div id="user-balance-container" class="text-muted mt-1">
      ржорзВрж▓ ржмрзНржпрж╛рж▓рзЗржирзНрж╕: <span id="user-balance" class="fw-bold text-success">рз│0.00</span> ржЯрж╛ржХрж╛
    </div>
  </div>

</header>

  
      <main id="main-content">
  <!-- =======================
       рж╣рзЛржо ржкрзЗржЬ
       ======================= -->
  <div id="home-page" class="page active">
    <!-- рж╢рж┐рж░рзЛржирж╛ржо + ржмрзНржпрж╛рж▓рзЗржирзНрж╕ ржмржХрзНрж╕ -->
    <div class="neo-header-box">
      <div>
        <div class="neo-title">BootEX ржбрзНржпрж╛рж╢ржмрзЛрж░рзНржб</div>
        <div class="neo-sub">ржЖржкржирж╛рж░ ржЖржпрж╝рзЗрж░ рж╕рж╛рж░рж╛ржВрж╢ ржУ ржХрж╛рж░рзНржпржХрж▓рж╛ржк ржПржХ ржЬрж╛ржпрж╝ржЧрж╛ржпрж╝</div>
      </div>
     
    </div>

    <!-- KPI ржХрж╛рж░рзНржбрж╕ржорзВрж╣ -->
    <div class="neo-stats-grid">
      <div class="neo-card">
        <div class="neo-icon"><i class="fas fa-bullseye"></i></div>
        <h4>ржЖржЬржХрзЗрж░ ржЕрзНржпрж╛ржб</h4>
        <p id="daily-ads-watched">0 / 0</p>
      </div>
      <div class="neo-card">
        <div class="neo-icon"><i class="fas fa-user-plus"></i></div>
        <h4>ржЯрзЛржЯрж╛рж▓ рж░рзЗржлрж╛рж░рж╛рж▓</h4>
        <p id="referral-count">0</p>
      </div>
      <div class="neo-card">
        <div class="neo-icon"><i class="fas fa-eye"></i></div>
        <h4>ржорзЛржЯ ржЕрзНржпрж╛ржб ржжрзЗржЦрж╛</h4>
        <p id="total-ads-watched">0</p>
      </div>
      <div class="neo-card">
        <div class="neo-icon"><i class="fas fa-sack-dollar"></i></div>
        <h4>ржЕрзНржпрж╛ржб ржЗржиржХрж╛ржо</h4>
        <p id="total-earned">0.00</p>
      </div>
    </div>

    <!-- ржЖржпрж╝рзЗрж░ ржЧрзНрж░рж╛ржл -->
    <div id="earnings-graph-container" class="neo-graph-box">
      <h3>ржЧржд рзн ржжрж┐ржирзЗрж░ ржЖржпрж╝рзЗрж░ ржЧрзНрж░рж╛ржл</h3>
      <div id="earnings-chart" class="chart"></div>
      <div id="earnings-chart-labels" class="chart-labels"></div>
    </div>

    <!-- ржбрж╛ржЗржирж╛ржорж┐ржХ рж▓рж┐ржВржХрж╕ржорзВрж╣ (JS ржкрзВрж░ржг ржХрж░ржмрзЗ) -->
    <div id="dynamic-links-container" class="neo-links-box"></div>
  </div>

  <!-- =======================
       ржЯрж╛рж╕рзНржХрж╕ ржкрзЗржЬ
       ======================= -->
  <div id="tasks-page" class="page">
    <!-- ржЖрж░рзНржирж┐ржВ ржУрзЯрж╛рж▓рзЗржЯ -->
    <div class="wallet-card">
      <div class="wallet-head"><h3>ржЖрж░рзНржирж┐ржВ ржУрзЯрж╛рж▓рзЗржЯ</h3></div>

      <div class="wallet-amount-box">
        <div class="wallet-amount-top">
          <span class="wallet-label">Balance</span>
          <span class="wallet-symbol">рз│</span>
        </div>
        <div class="wallet-amount-value">
          <span id="earning-wallet-balance">0.00</span>
        </div>
      </div>

      <small class="wallet-note">ржорзЗржЗржи ржмрзНржпрж╛рж▓рзЗржирзНрж╕рзЗ ржирж┐рждрзЗ ржХржоржкржХрзНрж╖рзЗ рззрзжрзж ржЯрж╛ржХрж╛ ржкрзНрж░ржпрж╝рзЛржЬржиред</small>
      <button id="move-to-balance-btn" class="action-btn wallet-btn" disabled>
        ржорзЗржЗржи ржмрзНржпрж╛рж▓рзЗржирзНрж╕рзЗ ржирж┐ржи
      </button>
    </div>

    <!-- ржжрзИржирж┐ржХ ржЕржЧрзНрж░ржЧрждрж┐ -->
    <div class="progress-card">
      <div class="progress-head"><h3>ржжрзИржирж┐ржХ ржЕрзНржпрж╛ржб ржкрзНрж░ржЧрзНрж░рзЗрж╕</h3></div>
      <div id="ad-progress-container" class="progress-container"></div>
    </div>

    <!-- рж░рж┐ржУржпрж╝рж╛рж░рзНржбрзЗржб ржЕрзНржпрж╛ржб ржЯрж╛рж╕рзНржХ (JS ржнрж░ржмрзЗ) -->
    <div id="ad-task-container" style="margin-top:16px;"></div>

    <!-- ржмрзЛржирж╛рж╕ ржЯрж╛рж╕рзНржХрж╕ржорзВрж╣ -->
    <h2 style="margin:16px 0 10px;">ржмрзЛржирж╛рж╕ ржЯрж╛рж╕рзНржХ</h2>
    <div id="dynamic-tasks-container" class="tasks-grid"></div>
  </div>

  <!-- =======================
       рж▓рж┐ржбрж╛рж░ржмрзЛрж░рзНржб ржкрзЗржЬ
       ======================= -->
  <div id="leaderboard-page" class="page">
    <h2 style="margin-bottom:10px;">рж▓рж┐ржбрж╛рж░ржмрзЛрж░рзНржб</h2>

    <div class="leaderboard-toggle">
      <button class="toggle-btn active" data-board="referral">рж╢рзАрж░рзНрж╖ рж░рзЗржлрж╛рж░рж╛рж░</button>
      <button class="toggle-btn" data-board="earning">рж╢рзАрж░рзНрж╖ ржЙржкрж╛рж░рзНржЬржиржХрж╛рж░рзА</button>
    </div>

    <div id="referral-board">
      <ul class="leaderboard-list modern" id="referral-leaderboard-list"></ul>
    </div>

    <div id="earning-board" style="display:none;">
      <ul class="leaderboard-list modern" id="earning-leaderboard-list"></ul>
    </div>
  </div>

  <!-- =======================
       рж╕рж╛ржкрзЛрж░рзНржЯ ржкрзЗржЬ
       ======================= -->
  <div id="support-page" class="page">
    <h2 style="margin-bottom:10px;">рж╕рж╛ржкрзЛрж░рзНржЯ</h2>

    <div class="task-container" style="flex-direction:column;align-items:stretch;">
      <h3>рж╣рзЗрж▓рзНржк ржжрж░ржХрж╛рж░?</h3>
      <p>ржпрзЗржХрзЛржи рж╕ржорж╕рзНржпрж╛ржпрж╝ ржЖржорж╛ржжрзЗрж░ ржЯрж┐ржорзЗрж░ рж╕рж╛ржерзЗ ржпрзЛржЧрж╛ржпрзЛржЧ ржХрж░рзБржи:</p>

   
      
<div class="support-grid" style="margin-top:10px;">
  <button id="btn-support-tg" class="action-btn">
    <i class="fa-brands fa-telegram"></i>&nbsp; ржЯрзЗрж▓рж┐ржЧрзНрж░рж╛ржо
  </button>
  <button id="btn-support-mail" class="action-btn">
    <i class="fa-regular fa-envelope"></i>&nbsp; ржЗржорзЗржЗрж▓
  </button>
</div>
      <small class="faq-hint">ржЯрж┐ржкрж╕: ржЖржорж╛ржжрзЗрж░ ржЪрзНржпрж╛ржирзЗрж▓рзЗ ржерж╛ржХрж╛ FAQ ржЖржЧрзЗ ржжрзЗржЦрзЗ ржирж┐ржиред</small>
    </div>
  </div>

  
  <div id="profile-page" class="page">

    <!-- ржЙржЗржержбрзНрж░ рж╕рзЗржХрж╢ржи (JS ржнрж░ржмрзЗ) -->
    <div id="withdraw-section" style="margin-top:12px;"></div>

    <!-- ржЙржЗржержбрзНрж░ рж╣рж┐рж╕рзНржЯрзНрж░рж┐ -->
    <div id="withdrawal-history-section" style="margin-top:20px;">
      <h2>ржЙржЗржержбрзНрж░рж╛рж▓ ржЗрждрж┐рж╣рж╛рж╕</h2>
      <div id="withdrawal-history-list" class="history-list modern"></div>
    </div>
  </div> 
        

<div class="floating-cta">

  <button class="cta-refer" data-page="refer-page">

    <i class="fa-solid fa-user-friends"></i>

    <span>Refer & Earn</span>

  </button>

  <button class="cta-help" data-page="support-page">?</button>

</div> 
        <!-- =======================
     рж░рзЗржлрж╛рж░ ржкрзЗржЬ
     ======================= -->
<div id="refer-page" class="page">
  <div class="wallet-card" style="margin-bottom:14px;">
    <h3>ржмржирзНржзрзБ рж░рзЗржлрж╛рж░ ржХрж░рзБржи ржУ ржЖрзЯ ржХрж░рзБржи!</h3>
    <p style="opacity:.85">ржкрзНрж░рждрж┐ рж░рзЗржлрж╛рж░рзЗ ржирж┐рж░рзНржзрж╛рж░рж┐ржд ржмрзЛржирж╛рж╕ ржкрж╛ржмрзЗржиред ржЖржкржирж╛рж░ ржмрзНржпржХрзНрждрж┐ржЧржд рж▓рж┐ржВржХржЯрж┐ ржХржкрж┐ ржХрж░рзЗ ржкрж╛ржарж╛ржиред</p>

    <!-- рж░рзЗржлрж╛рж░ рж▓рж┐ржВржХ -->
    <div class="wallet-amount-box" style="margin: 10px 0;">
      <div class="wallet-amount-top">
        <span class="wallet-label">ржЖржкржирж╛рж░ рж░рзЗржлрж╛рж░ рж▓рж┐ржВржХ</span>
      </div>
        <div id="referral-section"></div>
    </div>
  </div>

  <div class="progress-card">
    <h3>рж░рзЗржлрж╛рж░ ржирж┐рж░рзНржжрзЗрж╢ржирж╛</h3>
    <ul style="padding-left:20px;line-height:1.7;">
      <li>ржмржирзНржзрзБржжрзЗрж░ ржПржЗ рж▓рж┐ржВржХ ржкрж╛ржарж╛ржиред</li>
      <li>рждрж╛рж░рж╛ ржмржЯ ржЪрж╛рж▓рзБ ржХрж░рж▓рзЗржЗ ржЖржкржирж┐ ржмрзЛржирж╛рж╕ ржкрж╛ржмрзЗржиред</li>
      
    </ul>
  </div>
</div> 
        
</main>
      
    
      
      <nav class="bottom-nav">
  <button class="nav-btn" data-page="tasks-page">
    <i class="fas fa-briefcase"></i>
    <span>Tasks</span>
  </button>

  <button class="nav-btn" data-page="leaderboard-page">
    <i class="fas fa-medal"></i>
    <span>Top List</span>
  </button>

  <button class="nav-btn home-fab active" data-page="home-page" aria-label="Home">
    <i class="fas fa-house-chimney"></i>
    <span>Home</span>
  </button>

  <button class="nav-btn" data-page="support-page">
    <i class="fas fa-comments"></i>
    <span>Support</span>
  </button>

  <button class="nav-btn" data-page="profile-page">
    <i class="fas fa-wallet"></i>
    <span>Withdraw</span>
  </button>
</nav>
    </div>

    <!-- Firebase & Telegram -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <!-- NEW: Lottie runtime -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.12.2/lottie.min.js" integrity="sha512-arB9xF9n6M4ywU5M0Qw5Y0VlcMN60o3PG9mCqOoxv7cU79cUeOizlM0drm1e2Qh4f6bXcBUFqcb8QWxj1nH99Q==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    
   <script>  
// -----------------------------  
// data-page ржЕрзНржпрж╛ржЯрзНрж░рж┐ржмрж┐ржЙржЯ ржХрзНрж▓рж┐ржХ ржЗржнрзЗржирзНржЯ  
// -----------------------------  
document.querySelectorAll('[data-page]').forEach(btn=>{  
  btn.addEventListener('click', ()=>{  
    const target = btn.getAttribute('data-page');  
    document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));  
    document.getElementById(target).classList.add('active');  
  });  
});  
  
document.addEventListener('DOMContentLoaded', () => {  
  const tg = window.Telegram.WebApp;  
  
  /* ---------- NEW: Brand Loader Controller ---------- */  
  let lottiePlayer = null;  
  function startBrandLoader() {  
    const box = document.getElementById('lottie-box');  
    const fb  = document.getElementById('fallback-bounce');  
    try {  
      lottiePlayer = lottie.loadAnimation({  
        container: box,  
        renderer: 'svg',  
        loop: true,  
        autoplay: true,    
        path: 'https://assets9.lottiefiles.com/packages/lf20_j1adxtyb.json'  
      });  
      fb.style.display = 'none';  
    } catch(e) {  
      fb.style.display = 'flex'; // fallback bounce  
    }  
  }  
  function stopBrandLoader() {  
    try { lottiePlayer && lottiePlayer.destroy && lottiePlayer.destroy(); } catch(e){}  
    const loader = document.getElementById('app-loader');  
    loader.classList.add('loader-hide');  
    setTimeout(()=> loader.style.display='none', 360);  
  }  
  // Loader text helper (percent тЖТ human text)  
  const loaderTextEl = document.getElementById('loader-text');  
  const updateProgress = (p) => {  
    if (!loaderTextEl) return;  
    if (p < 30) loaderTextEl.textContent = 'BootEX ржкрзНрж░рж╕рзНрждрзБрждрж┐ ржЪрж▓ржЫрзЗтАж';  
    else if (p < 60) loaderTextEl.textContent = 'ржбрзЗржЯрж╛ рж╕рж┐ржЩрзНржХ рж╣ржЪрзНржЫрзЗтАж';  
    else if (p < 90) loaderTextEl.textContent = 'ржкрзНрж░рж╛ржпрж╝ рж╢рзЗрж╖тАж';  
    else loaderTextEl.textContent = 'рж░рзЗржбрж┐!';  
  };  
  startBrandLoader();  
  
  
  // For Firebase JS SDK v7.20.0 and later, measurementId is optional  
  const firebaseConfig = {  
    apiKey: "##",  
    authDomain: "##",  
    databaseURL: "##",  
    projectId: "##",  
    storageBucket: "##",  
    messagingSenderId: "##",  
    appId: "##",  
    measurementId: "##"  
  };  
  
  let appConfig = {}; let userState = {}; let tgUser = {}; let earningWalletBalance = 0;  
  let leaderboardData = { referral: [], earning: [] };  
  let userTransactions = [];  
  
  const popup = document.getElementById('popup');  
  const popupBody = document.getElementById('popup-body');  
  const showPopup = (content) => { popupBody.innerHTML = content; popup.style.display = 'flex'; };  
  const closePopup = () => { popup.style.display = 'none'; };  
  
  const loadAdSdk = (zoneId) => {  
    if (!zoneId) { console.error("Ad Zone ID is missing from Firebase config!"); return; }  
    if (document.querySelector(`script[data-zone='${zoneId}']`)) return;  
    const script = document.createElement('script');  
    script.src = `//libtl.com/sdk.js`;  
    script.setAttribute('data-zone', zoneId);  
    script.setAttribute('data-sdk', `show_${zoneId}`);  
    script.async = true;  
    document.body.appendChild(script);  
  };  

  
  function attachSupportLinks() {
    const tgBtn   = document.getElementById('btn-support-tg');
    const mailBtn = document.getElementById('btn-support-mail');
    if (!tgBtn || !mailBtn) return;

    const support = (appConfig && appConfig.support) ? appConfig.support : {};
    const tgUrl   = (support.telegramUrl || '').trim();
    const email   = (support.email || '').trim();

    // Telegram button
    if (tgUrl) {
      tgBtn.disabled = false;
      tgBtn.onclick = () => {
        const url = tgUrl.startsWith('http') || tgUrl.startsWith('tg:')
          ? tgUrl
          : `https://t.me/${tgUrl.replace('@','')}`;
        if (window.Telegram?.WebApp?.openLink) {
          window.Telegram.WebApp.openLink(url);
        } else {
          window.open(url, '_blank');
        }
      };
      tgBtn.title = '';
    } else {
      tgBtn.disabled = true;
      tgBtn.title = 'ржЕрзНржпрж╛ржбржорж┐ржи ржкрзНржпрж╛ржирзЗрж▓рзЗ рж╕рж╛ржкрзЛрж░рзНржЯ ржЯрзЗрж▓рж┐ржЧрзНрж░рж╛ржо URL рж╕рзЗржЯ ржХрж░рзБржи';
      tgBtn.onclick = null;
    }

    if (email) {
      mailBtn.disabled = false;
      mailBtn.onclick = () => {
        const href = email.startsWith('mailto:') ? email : `mailto:${email}`;
        if (window.Telegram?.WebApp?.openLink) {
          window.Telegram.WebApp.openLink(href);
        } else {
          window.location.href = href;
        }
      };
      mailBtn.title = '';
    } else {
      mailBtn.disabled = true;
      mailBtn.title = 'ржЕрзНржпрж╛ржбржорж┐ржи ржкрзНржпрж╛ржирзЗрж▓рзЗ рж╕рж╛ржкрзЛрж░рзНржЯ ржЗржорзЗржЗрж▓ рж╕рзЗржЯ ржХрж░рзБржи';
      mailBtn.onclick = null;
    }
  }
  

  const initApp = async () => {  
    tg.ready(); tg.expand();  
    document.body.className = `${tg.colorScheme}-theme`;  
    tgUser = tg.initDataUnsafe.user;  
    if (!tgUser || !tgUser.id) { tg.showAlert("ржЗржЙржЬрж╛рж░ ржбрж╛ржЯрж╛ ржкрж╛ржУржпрж╝рж╛ ржпрж╛ржпрж╝ржирж┐ред"); tg.close(); return; }  
  
    try {  
      updateProgress(10); firebase.initializeApp(firebaseConfig); const db = firebase.database();  
      updateProgress(20);  
  
      const configSnapshot = await db.ref('config').once('value');  
      appConfig = configSnapshot.val() || {};  
      updateProgress(40);  
  
      await loadUserData(db); // depends on appConfig  
      updateProgress(60);  
  
      const referralBoardPromise = db.ref('users').orderByChild('referrals').limitToLast(10).once('value');  
      const earningBoardPromise = db.ref('users').orderByChild('totalEarned').limitToLast(10).once('value');  
      const historyPromise = loadTransactionHistory(db);  
  
      const [referralBoardSnap, earningBoardSnap] = await Promise.all([referralBoardPromise, earningBoardPromise, historyPromise]);  
      updateProgress(80);  
  
      referralBoardSnap.forEach(child => { leaderboardData.referral.push(child.val()); });  
      earningBoardSnap.forEach(child => { leaderboardData.earning.push(child.val()); });  
      leaderboardData.referral.reverse(); leaderboardData.earning.reverse();  
      updateProgress(90);  
  
      loadAdSdk(appConfig.adZoneId);  
      earningWalletBalance = parseFloat(localStorage.getItem(`earningWallet_${tgUser.id}`) || '0');  
  
      renderUI(); setupNavigation(); setupEventListeners();  
      updateProgress(100);  
  
      setTimeout(() => {  
        stopBrandLoader();  
        document.getElementById('app').style.display = 'block';  
        if (appConfig.welcomeMessage && !userState.welcomed) {  
          showPopup(`<h2>рж╕рзНржмрж╛ржЧрждржо!</h2><p>${appConfig.welcomeMessage}</p><button class="popup-close-btn">ржЪрж╛рж▓рж┐ржпрж╝рзЗ ржпрж╛ржи</button>`);  
          db.ref(`users/${tgUser.id}/welcomed`).set(true);  
        }  
      }, 300);  
    } catch (error) {  
      console.error("Initialization failed:", error);  
      tg.showAlert("ржЕрзНржпрж╛ржк ржбрж╛ржЯрж╛ рж▓рзЛржб рж╣ржпрж╝ржирж┐ред ржЕржирзБржЧрзНрж░рж╣ ржХрж░рзЗ ржЖржмрж╛рж░ ржЪрзЗрж╖рзНржЯрж╛ ржХрж░рзБржиред");  
    }  
  };  
  
  const loadUserData = async (db) => {  
    const userRef = db.ref(`users/${tgUser.id}`);  
    const snapshot = await userRef.once('value');  
    let userData = snapshot.val();  
  
    if (!userData) {  
      const startParam = tg.initDataUnsafe.start_param;  
      const referralId = (startParam && !isNaN(startParam)) ? startParam : null;  
  
      userData = {  
        id: tgUser.id, firstName: tgUser.first_name || '', lastName: tgUser.last_name || '',  
        username: tgUser.username || '', photoUrl: tgUser.photo_url || '',  
        balance: 0, referrals: 0, referredBy: referralId, totalEarned: 0, lifetimeAdCount: 0,  
        lastAdWatchDate: '1970-01-01', dailyAdCount: 0, breakUntil: 0, completedTasks: {}, welcomed: false  
      };  
      await userRef.set(userData);  
  
      if (referralId && referralId != tgUser.id) {  
        const referrerRef = db.ref(`users/${referralId}`);  
        const bonusAmount = parseFloat(appConfig.referralBonus || 0);  
        if (bonusAmount > 0) {  
          await referrerRef.transaction(currentData => {  
            if (currentData) {  
              currentData.balance = (currentData.balance || 0) + bonusAmount;  
              currentData.referrals = (currentData.referrals || 0) + 1;  
            }  
            return currentData;  
          });  
        } else {  
          await referrerRef.child('referrals').set(firebase.database.ServerValue.increment(1));  
        }  
      }  
    }  
  
    const today = new Date().toISOString().slice(0, 10);  
    if (userData.lastAdWatchDate !== today) {  
      userData.dailyAdCount = 0; userData.lastAdWatchDate = today;  
      await userRef.update({ dailyAdCount: 0, lastAdWatchDate: today });  
    }  
    userState = userData;  
  };  
  
  const loadTransactionHistory = async (db) => {  
    userTransactions = [];  
    const statuses = ['pending', 'completed', 'rejected'];  
    const historyPromises = statuses.map(status => db.ref(`withdrawals/${status}`).orderByChild('userId').equalTo(tgUser.id).once('value'));  
    const snapshots = await Promise.all(historyPromises);  
    snapshots.forEach(snap => { snap.forEach(childSnap => { userTransactions.push(childSnap.val()); }); });  
    userTransactions.sort((a, b) => b.timestamp - a.timestamp);  
  };  
  
  const renderUI = () => {  
    document.getElementById('user-photo').src = userState.photoUrl || 'https://via.placeholder.com/80';  
    document.getElementById('user-name').textContent = `${userState.firstName} ${userState.lastName}`;  
    document.getElementById('user-balance').textContent = (userState.balance || 0).toFixed(2);  
    document.getElementById('daily-ads-watched').textContent = `${userState.dailyAdCount || 0} / ${appConfig.dailyAdLimit || 0}`;  
    document.getElementById('referral-count').textContent = userState.referrals || 0;  
    document.getElementById('total-ads-watched').textContent = userState.lifetimeAdCount || 0;  
    document.getElementById('total-earned').textContent = (userState.totalEarned || 0).toFixed(2);  
    document.getElementById('earning-wallet-balance').textContent = earningWalletBalance.toFixed(2);  
    document.getElementById('move-to-balance-btn').disabled = earningWalletBalance < 100;  
  
    renderAdTask();  
    renderAdProgress();  
    renderDynamicTasks();  
    renderReferralSection();  
    renderWithdrawSection();  
    renderEarningsGraph();  
    renderDynamicLinks();

    
    attachSupportLinks();
  };  
  
  const renderAdProgress = () => {  
    const container = document.getElementById('ad-progress-container');  
    const dailyLimit = appConfig.dailyAdLimit || 1;  
    const watchedCount = userState.dailyAdCount || 0;  
    const percentage = (watchedCount / dailyLimit) * 100;  
    container.innerHTML = `  
      <div class="progress-info">  
        <span>ржжрзИржирж┐ржХ ржмрж┐ржЬрзНржЮрж╛ржкржи ржЕржЧрзНрж░ржЧрждрж┐</span>  
        <span>${watchedCount} / ${dailyLimit}</span>  
      </div>  
      <div class="progress-bar-bg"><div class="progress-bar-fg" style="width: ${percentage}%;"></div></div>`;  
  };  
  
  const renderEarningsGraph = async () => {  
    const chartEl = document.getElementById('earnings-chart');  
    const labelsEl = document.getElementById('earnings-chart-labels');  
    chartEl.innerHTML = ''; labelsEl.innerHTML = '';  
    const today = new Date(); const dates = [];  
    for (let i = 6; i >= 0; i--) { const date = new Date(today); date.setDate(today.getDate() - i); dates.push(date.toISOString().slice(0, 10)); }  
    const earningsPromises = dates.map(date => firebase.database().ref(`userEarnings/${tgUser.id}/${date}`).once('value'));  
    const snapshots = await Promise.all(earningsPromises);  
    const earningsData = snapshots.map(snap => snap.val() || 0);  
    const maxEarning = Math.max(...earningsData, 1);  
    earningsData.forEach((earning, index) => {  
      const height = (earning / maxEarning) * 100;  
      const dateLabel = new Date(dates[index]).toLocaleDateString('bn-BD', { day: 'numeric' });  
      chartEl.innerHTML += `<div class="bar" style="height: ${height}%;"><span class="tooltip">${earning.toFixed(2)} ржЯрж╛ржХрж╛</span></div>`;  
      labelsEl.innerHTML += `<span>${dateLabel}</span>`;  
    });  
  };  
  
  const handleWatchAd = async () => {  
    if (userState.dailyAdCount >= appConfig.dailyAdLimit) { tg.showAlert("ржжрзИржирж┐ржХ ржмрж┐ржЬрзНржЮрж╛ржкржи ржжрзЗржЦрж╛рж░ рж╕рзАржорж╛ ржкрзВрж░рзНржг рж╣ржпрж╝рзЗржЫрзЗред"); return; }  
    const now = Date.now();  
    if (userState.breakUntil && now < userState.breakUntil) {  
      const remaining = Math.ceil((userState.breakUntil - now) / 60000);  
      tg.showAlert(`ржЕржирзБржЧрзНрж░рж╣ ржХрж░рзЗ ржЖрж░ржУ ${remaining} ржорж┐ржирж┐ржЯ ржЕржкрзЗржХрзНрж╖рж╛ ржХрж░рзБржиред`); return;  
    }  
  
    const adFunction = window['show_' + appConfig.adZoneId];  
    if (typeof adFunction !== 'function') {  
      tg.showAlert("ржмрж┐ржЬрзНржЮрж╛ржкржи ржирзЗржЯржУржпрж╝рж╛рж░рзНржХ ржкрзНрж░рж╕рзНрждрзБржд ржиржпрж╝ред ржХржпрж╝рзЗржХ рж╕рзЗржХрзЗржирзНржб ржкрж░ ржЖржмрж╛рж░ ржЪрзЗрж╖рзНржЯрж╛ ржХрж░рзБржиред"); return; }  
  
    showPopup(`<div class="popup-loader"><div class="spinner"></div></div><h2>ржмрж┐ржЬрзНржЮрж╛ржкржи рж▓рзЛржб рж╣ржЪрзНржЫрзЗ</h2><p>ржжржпрж╝рж╛ ржХрж░рзЗ ржПржХржЯрзБ ржЕржкрзЗржХрзНрж╖рж╛ ржХрж░рзБржитАж</p>`);  
  
    try {  
      await adFunction();  
      closePopup();  
      const adValue = appConfig.adValue || 0;  
  
      earningWalletBalance += adValue;  
      localStorage.setItem(`earningWallet_${tgUser.id}`, earningWalletBalance.toString());  
  
      userState.dailyAdCount++;  
      userState.lifetimeAdCount++;  
      userState.totalEarned = (userState.totalEarned || 0) + adValue;  
  
      const db = firebase.database(); const userRef = db.ref(`users/${tgUser.id}`);  
      const updates = {};  
      updates.dailyAdCount = userState.dailyAdCount;  
      updates.lifetimeAdCount = userState.lifetimeAdCount;  
      updates.totalEarned = userState.totalEarned;  
      if ((userState.dailyAdCount) % appConfig.adsPerBreak === 0 && appConfig.adsPerBreak > 0) {  
        updates.breakUntil = Date.now() + (appConfig.breakDuration * 60000);  
        userState.breakUntil = updates.breakUntil;  
      }  
      await userRef.update(updates);  
  
      const today = new Date().toISOString().slice(0, 10);  
      await db.ref(`userEarnings/${tgUser.id}/${today}`).set(firebase.database.ServerValue.increment(adValue));  
  
      tg.HapticFeedback.notificationOccurred('success');  
      tg.showAlert(`+${adValue.toFixed(2)} ржЯрж╛ржХрж╛ ржЖржкржирж╛рж░ ржЖрж░рзНржирж┐ржВ ржУржпрж╝рж╛рж▓рзЗржЯрзЗ ржпрзБржХрзНржд рж╣ржпрж╝рзЗржЫрзЗред`);  
  
      renderUI();  
  
    } catch (error) {  
      console.error("Ad failed to load:", error);  
      closePopup();  
      tg.showAlert("ржмрж┐ржЬрзНржЮрж╛ржкржи рж▓рзЛржб ржХрж░рж╛ ржпрж╛ржпрж╝ржирж┐ред ржЖржмрж╛рж░ ржЪрзЗрж╖рзНржЯрж╛ ржХрж░рзБржиред");  
    }  
  };  
  
  const handleMoveToBalance = async () => {  
    if(earningWalletBalance < 100) { tg.showAlert("ржорзЗржЗржи ржмрзНржпрж╛рж▓рзЗржирзНрж╕рзЗ ржирж┐рждрзЗ ржирзНржпрзВржирждржо рззрзжрзж ржЯрж╛ржХрж╛ ржкрзНрж░ржпрж╝рзЛржЬржиред"); return; }  
    const btn = document.getElementById('move-to-balance-btn'); btn.disabled = true; btn.textContent = 'рж╕рзНржерж╛ржирж╛ржирзНрждрж░ рж╣ржЪрзНржЫрзЗтАж';  
    try {  
      const db = firebase.database();  
      await db.ref(`users/${tgUser.id}/balance`).set(firebase.database.ServerValue.increment(earningWalletBalance));  
      userState.balance += earningWalletBalance;  
      earningWalletBalance = 0;  
      localStorage.setItem(`earningWallet_${tgUser.id}`, '0');  
      tg.HapticFeedback.notificationOccurred('success');  
      tg.showAlert("рж╕ржлрж▓ржнрж╛ржмрзЗ ржорзЗржЗржи ржмрзНржпрж╛рж▓рзЗржирзНрж╕рзЗ рж╕рзНржерж╛ржирж╛ржирзНрждрж░ рж╣ржпрж╝рзЗржЫрзЗ!");  
    } catch(error) {  
      console.error("Failed to move balance:", error);  
      tg.showAlert("рж╕рзНржерж╛ржирж╛ржирзНрждрж░ ржмрзНржпрж░рзНрже рж╣ржпрж╝рзЗржЫрзЗред ржЖржмрж╛рж░ ржЪрзЗрж╖рзНржЯрж╛ ржХрж░рзБржиред");  
    } finally { btn.textContent = 'ржорзЗржЗржи ржмрзНржпрж╛рж▓рзЗржирзНрж╕рзЗ ржирж┐ржи'; renderUI(); }  
  };  
  
  const renderWithdrawalHistory = () => {  
    const listEl = document.getElementById('withdrawal-history-list');  
    if (userTransactions.length === 0) { listEl.innerHTML = '<p>ржХрзЛржиржУ ржЙржЗржержбрзНрж░ рж╣рж┐рж╕рзНржЯрзНрж░рж┐ ржкрж╛ржУржпрж╝рж╛ ржпрж╛ржпрж╝ржирж┐ред</p>'; return; }  
    listEl.innerHTML = userTransactions.map(item => `  
      <div class="history-item">  
        <div class="history-details">  
          <p>${item.amount.toFixed(2)} ржЯрж╛ржХрж╛ - ${item.method}</p>  
          <small>${new Date(item.timestamp).toLocaleString('bn-BD')}</small>  
        </div>  
        <span class="history-status status-${item.status}">${item.status}</span>  
      </div>`).join('');  
  };  
  
  const setupNavigation = () => {  
    const navButtons = document.querySelectorAll('.nav-btn'); const pages = document.querySelectorAll('.page');  
    navButtons.forEach(button => {  
      button.addEventListener('click', () => {  
        const pageId = button.dataset.page;  
        pages.forEach(page => page.classList.remove('active'));  
        document.getElementById(pageId).classList.add('active');  
        navButtons.forEach(btn => btn.classList.remove('active'));  
        button.classList.add('active');  
        if (pageId === 'profile-page') { renderWithdrawalHistory(); }  
        if (pageId === 'leaderboard-page') { renderLeaderboard(); }  
      });  
    });  
  };  
  
  const setupEventListeners = () => {  
    popup.addEventListener('click', (e) => { if (e.target.classList.contains('popup-close-btn') || e.target.id === 'popup') closePopup(); });  
    document.querySelector('.leaderboard-toggle').addEventListener('click', (e) => {  
      if(e.target.classList.contains('toggle-btn')) {  
        document.querySelectorAll('.toggle-btn').forEach(b => b.classList.remove('active'));  
        e.target.classList.add('active');  
        renderLeaderboard();  
      }  
    });  
    document.getElementById('dynamic-tasks-container').addEventListener('click', (e) => handleClaimTask(e));  
    document.getElementById('profile-page').addEventListener('submit', (e) => handleWithdraw(e));  
    document.getElementById('referral-section').addEventListener('click', (e) => { if(e.target.id === 'copy-ref-link-btn') copyReferralLink(); });  
    document.getElementById('move-to-balance-btn').addEventListener('click', handleMoveToBalance);  
  };  
  
  const renderAdTask = () => {  
    const container = document.getElementById('ad-task-container');  
    const now = Date.now();  
    const onBreak = userState.breakUntil && now < userState.breakUntil;  
    const limitReached = userState.dailyAdCount >= appConfig.dailyAdLimit;  
    let html = '';  
    if (onBreak) {  
      const remaining = Math.ceil((userState.breakUntil - now) / 60000);  
      html = `<div class="task-container">  
        <img class="task-icon-img" src="https://img.icons8.com/ios-filled/100/hourglass.png" alt="icon">  
        <div class="task-info"><h3>ржмрж┐рж░рждрж┐ ржЪрж▓ржЫрзЗ</h3><p>ржЕржирзБржЧрзНрж░рж╣ ржХрж░рзЗ ржЖрж░ржУ ${remaining} ржорж┐ржирж┐ржЯ ржЕржкрзЗржХрзНрж╖рж╛ ржХрж░рзБржиред</p></div>  
        <button class="action-btn" disabled>ржЕржкрзЗржХрзНрж╖ржорж╛ржи</button>  
      </div>`;  
    } else if (limitReached) {  
      html = `<div class="task-container">  
        <img class="task-icon-img" src="https://img.icons8.com/ios-filled/100/stop-circled.png" alt="icon">  
        <div class="task-info"><h3>ржжрзИржирж┐ржХ рж╕рзАржорж╛ ржкрзВрж░рзНржг</h3><p>ржЖржЧрж╛ржорзАржХрж╛рж▓ ржЖржмрж╛рж░ ржЪрзЗрж╖рзНржЯрж╛ ржХрж░рзБржиред</p></div>  
        <button class="action-btn" disabled>рж╕рзАржорж╛</button>  
      </div>`;  
    } else {  
      html = `<div class="task-container">  
        <img class="task-icon-img" src="https://img.icons8.com/ios-filled/100/play-button-circled.png" alt="icon">  
        <div class="task-info"><h3>ржкрзБрж░рж╕рзНржХрж╛рж░ ржмрж┐ржЬрзНржЮрж╛ржкржи ржжрзЗржЦрзБржи</h3><p>ржкрзНрж░рждрж┐ ржмрж┐ржЬрзНржЮрж╛ржкржирзЗ ржЙржкрж╛рж░рзНржЬржи: ${appConfig.adValue || 0} ржЯрж╛ржХрж╛</p></div>  
        <button id="watch-ad-btn" class="action-btn">ржмрж┐ржЬрзНржЮрж╛ржкржи ржжрзЗржЦрзБржи</button>  
      </div>`;  
    }  
    container.innerHTML = html;  
    if (!onBreak && !limitReached) { document.getElementById('watch-ad-btn').addEventListener('click', handleWatchAd); }  
  };  
  
  const handleClaimTask = async (e) => {  
    if (e.target.classList.contains('action-btn') && e.target.dataset.taskId) {  
      const taskId = e.target.dataset.taskId;  
      const task = appConfig.tasks[taskId];  
      if (!task || (userState.completedTasks && userState.completedTasks[taskId])) { tg.showAlert('ржПржЗ ржмрзЛржирж╛рж╕ржЯрж┐ ржЖржкржирж┐ ржЗрждрж┐ржоржзрзНржпрзЗржЗ ржирж┐ржпрж╝рзЗржЫрзЗржиред'); return; }  
      tg.openLink(e.target.dataset.taskUrl);  
      e.target.disabled = true; e.target.textContent = 'ржХрзНрж▓рзЗржЗржо рж╣ржЪрзНржЫрзЗтАж';  
      setTimeout(async () => {  
        try {  
          const db = firebase.database(); const userRef = db.ref(`users/${tgUser.id}`);  
          await userRef.child(`completedTasks/${taskId}`).set(true);  
          await userRef.child('balance').set(firebase.database.ServerValue.increment(task.reward));  
          userState.balance += task.reward;  
          if (!userState.completedTasks) userState.completedTasks = {};  
          userState.completedTasks[taskId] = true;  
          tg.HapticFeedback.notificationOccurred('success');  
          tg.showAlert(`ржзржирзНржпржмрж╛ржж! ржЖржкржирж┐ ${task.reward} ржЯрж╛ржХрж╛ ржмрзЛржирж╛рж╕ ржкрзЗржпрж╝рзЗржЫрзЗржиред`);  
          renderUI();  
        } catch (error) {  
          tg.showAlert('ржмрзЛржирж╛рж╕ ржХрзНрж▓рзЗржЗржо ржХрж░рж╛ ржпрж╛ржпрж╝ржирж┐ред ржЖржмрж╛рж░ ржЪрзЗрж╖рзНржЯрж╛ ржХрж░рзБржиред');  
          e.target.disabled = false; e.target.textContent = 'ржмрзЛржирж╛рж╕ ржХрзНрж▓рзЗржЗржо ржХрж░рзБржи';  
        }  
      }, 5000);  
    }  
  };  
  
  const handleWithdraw = async (e) => {  
    if(e.target.id !== 'withdraw-form') return;  
    e.preventDefault();  
  
    const minRefsRequired = appConfig.minimumWithdrawReferrals || 0;  
    const userReferrals = userState.referrals || 0;  
    if (minRefsRequired > 0 && userReferrals < minRefsRequired) {  
      tg.showAlert(`ржЙржЗржержбрзНрж░ ржмрзНржпрж░рзНрже рж╣ржпрж╝рзЗржЫрзЗред ржЙржЗржержбрзНрж░ ржХрж░рж╛рж░ ржЬржирзНржп ржЕржирзНрждржд ${minRefsRequired} ржЬржи рж░рзЗржлрж╛рж░рж╛рж▓ ржкрзНрж░ржпрж╝рзЛржЬржиред ржмрж░рзНрждржорж╛ржирзЗ ржЖржкржирж╛рж░ рж░рзЗржлрж╛рж░рж╛рж▓ рж╕ржВржЦрзНржпрж╛ ${userReferrals} ржЬржиред`);  
      return;  
    }  
  
    const methodEl = document.getElementById('withdraw-method');  
    const accountNumber = document.getElementById('account-number').value;  
    const amount = parseFloat(document.getElementById('amount').value);  
    const selectedMethod = appConfig.withdrawMethods.find(m => m.name === methodEl.value);  
  
    if (isNaN(amount) || amount <= 0) { tg.showAlert("ржжржпрж╝рж╛ ржХрж░рзЗ ржПржХржЯрж┐ ржмрзИржз ржкрж░рж┐ржорж╛ржг рж▓рж┐ржЦрзБржиред"); return; }  
    if (!selectedMethod) { tg.showAlert("ржнрзБрж▓ ржЙржЗржержбрзНрж░ ржкржжрзНржзрждрж┐ред"); return; }  
    if (amount < selectedMethod.min) { tg.showAlert(`${selectedMethod.name} ржкржжрзНржзрждрж┐рждрзЗ ржирзНржпрзВржирждржо ржЙржЗржержбрзНрж░ ${selectedMethod.min} ржЯрж╛ржХрж╛ред`); return; }  
    if (amount > userState.balance) { tg.showAlert("ржЖржкржирж╛рж░ ржпржерзЗрж╖рзНржЯ ржмрзНржпрж╛рж▓рзЗржирзНрж╕ ржирзЗржЗред"); return; }  
  
    const btn = document.getElementById('withdraw-submit-btn'); btn.disabled = true; btn.textContent = 'ржЬржорж╛ рж╣ржЪрзНржЫрзЗтАж';  
    const db = firebase.database();  
    try {  
      const userRef = db.ref(`users/${tgUser.id}`);  
      userState.balance -= amount;  
      renderUI();  
  
      await userRef.child('balance').set(firebase.database.ServerValue.increment(-amount));  
      const reqId = db.ref('withdrawals/pending').push().key;  
      const newRequest = {  
        id: reqId, userId: tgUser.id, userName: `${userState.firstName} ${userState.lastName}`,  
        method: selectedMethod.name, account: accountNumber, amount: amount,  
        status: 'pending', timestamp: firebase.database.ServerValue.TIMESTAMP  
      };  
      await db.ref(`withdrawals/pending/${reqId}`).set(newRequest);  
  
      userTransactions.unshift(newRequest);  
      renderWithdrawalHistory();  
  
      tg.HapticFeedback.notificationOccurred('success');  
      tg.showAlert("ржЯрж╛ржХрж╛ рждрзЛрж▓рж╛рж░ ржЕржирзБрж░рзЛржз рж╕ржлрж▓ржнрж╛ржмрзЗ ржЬржорж╛ ржжрзЗржУржпрж╝рж╛ рж╣ржпрж╝рзЗржЫрзЗ!");  
      document.getElementById('withdraw-form').reset();  
    } catch (error) {  
      userState.balance += amount;  
      tg.HapticFeedback.notificationOccurred('error');  
      tg.showAlert("ржЕржирзБрж░рзЛржз ржЬржорж╛ ржмрзНржпрж░рзНрже рж╣ржпрж╝рзЗржЫрзЗред ржЖржкржирж╛рж░ ржмрзНржпрж╛рж▓рзЗржирзНрж╕ ржкрзВрж░рзНржмрж╛ржмрж╕рзНржерж╛ржпрж╝ ржлрж┐рж░рж┐ржпрж╝рзЗ ржжрзЗржпрж╝рж╛ рж╣ржпрж╝рзЗржЫрзЗред");  
    } finally {  
      renderUI();  
      btn.disabled = false;  
      btn.textContent = 'ржЕржирзБрж░рзЛржз ржЬржорж╛ ржжрж┐ржи';  
    }  
  };  
  
  const copyReferralLink = () => {  
    const refLinkInput = document.getElementById('referral-link');  
    refLinkInput.select();  
    refLinkInput.setSelectionRange(0, 99999);  
    try {  
      navigator.clipboard.writeText(refLinkInput.value).then(() => {  
        tg.HapticFeedback.notificationOccurred('success');  
        tg.showAlert("рж░рзЗржлрж╛рж░рзЗрж▓ рж▓рж┐ржЩрзНржХ ржХржкрж┐ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗ!");  
      });  
    } catch (err) {  
      document.execCommand('copy');  
      tg.HapticFeedback.notificationOccurred('success');  
      tg.showAlert("рж░рзЗржлрж╛рж░рзЗрж▓ рж▓рж┐ржЩрзНржХ ржХржкрж┐ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗ!");  
    }  
  };  
  
  const renderLeaderboard = () => {  
    const activeBoard = document.querySelector('.toggle-btn.active').dataset.board;  
    const listEl = document.getElementById(activeBoard === 'referral' ? 'referral-leaderboard-list' : 'earning-leaderboard-list');  
    const data = leaderboardData[activeBoard];  
    document.getElementById('referral-board').style.display = activeBoard === 'referral' ? 'block' : 'none';  
    document.getElementById('earning-board').style.display = activeBoard === 'earning' ? 'block' : 'none';  
    listEl.innerHTML = '';  
    if (data.length === 0) { listEl.innerHTML = '<li>ржХрзЛржи рждржерзНржп ржирзЗржЗред</li>'; return; }  
    data.forEach((user, index) => {  
      const score = activeBoard === 'referral' ? (user.referrals || 0) : (user.totalEarned || 0).toFixed(2);  
      const item = document.createElement('li'); item.className = 'leaderboard-item';  
      item.innerHTML = `  
        <span class="rank" style="width:36px;text-align:center;font-weight:800;color:var(--primary-color);font-size:1rem;">ЁЯПЕ #${index + 1}</span>  
        <img src="${user.photoUrl || 'https://via.placeholder.com/50'}" alt="User" style="width:46px;height:46px;border-radius:50%;object-fit:cover;border:2px solid var(--primary-color);box-shadow:0 2px 8px rgba(231,76,60,0.2);margin-right:10px;">  
        <span class="leaderboard-name" style="flex-grow:1;font-weight:600;font-size:0.95rem;">${user.firstName}</span>  
        <span class="leaderboard-score" style="font-weight:700;color:var(--secondary-color);font-size:1rem;">${score}</span>`;  
      listEl.appendChild(item);  
    });  
  };  
  
  const renderDynamicTasks = () => {  
    const container = document.getElementById('dynamic-tasks-container'); container.innerHTML = '';  
    if (appConfig.tasks) {  
      const tasks = [];  
      for(const key in appConfig.tasks) { tasks.push({key, ...appConfig.tasks[key]}); }  
      tasks.reverse();  
      tasks.forEach(task => {  
        const isCompleted = userState.completedTasks && userState.completedTasks[task.key];  
        const el = document.createElement('div'); el.className = 'task-container';  
        el.innerHTML = `  
          <img class="task-icon-img" src="${task.icon}" alt="icon"  
               style="width:50px;height:50px;border-radius:12px;object-fit:cover;border:2px solid var(--primary-color);box-shadow:0 2px 8px rgba(0,0,0,0.08);">  
          <div class="task-info" style="flex-grow:1;">  
            <h3 style="font-size:1.05rem;font-weight:700;margin-bottom:5px;color:var(--primary-color);">${task.name}</h3>  
            <p style="font-size:0.9rem;opacity:0.85;">ЁЯОБ рж╕ржорзНржкржирзНржи ржХрж░рж▓рзЗ ржкрж╛ржмрзЗржи <b>${task.reward} ржЯрж╛ржХрж╛</b> ржмрзЛржирж╛рж╕</p>  
          </div>  
          <button class="action-btn" data-task-id="${task.key}" data-task-url="${task.url}" ${isCompleted ? 'disabled' : ''}  
                  style="padding:10px 18px;border-radius:10px;font-weight:700;font-size:0.9rem;box-shadow:0 2px 10px rgba(231,76,60,0.25);">  
            ${isCompleted ? 'тЬЕ ржирзЗржУржпрж╝рж╛ рж╣ржпрж╝рзЗржЫрзЗ' : 'ЁЯОп ржмрзЛржирж╛рж╕ ржирж┐ржи'}  
          </button>`;  
        container.appendChild(el);  
      });  
    }  
  };  
  
  const renderReferralSection = () => {  
    const container = document.getElementById('referral-section');  
    const refLink = `https://t.me/${appConfig.botUsername}/app?startapp=${tgUser.id}`;  
    container.innerHTML = `  
      <div class="task-container" style="flex-direction: column; align-items: stretch; background: var(--surface-light); border-radius: 14px; padding: 18px; box-shadow: 0 3px 12px rgba(0,0,0,0.06); border: 1px solid var(--border-light);">  
        <h3 style="margin-bottom: 8px; color: var(--primary-color); font-weight: 700; font-size: 1.1rem;">ЁЯдЭ рж░рзЗржлрж╛рж░ ржХрж░рзЗ ржЖржпрж╝ ржХрж░рзБржи</h3>  
        <p style="font-size: 0.95rem; margin-bottom: 14px; opacity: 0.85;">  
          ржЖржкржирж╛рж░ ржмржирзНржзрзБржжрзЗрж░ ржЖржоржирзНрждрзНрж░ржг ржХрж░рзБржи ржПржмржВ ржкрзНрж░рждрж┐ рж░рзЗржлрж╛рж░рзЗрж▓рзЗ <b>${appConfig.referralBonus || 0} ржЯрж╛ржХрж╛</b> ржЙржкрж╛рж░рзНржЬржи ржХрж░рзБржиред  
        </p>  
        <div style="display:flex; flex-direction:column; gap:10px;">  
          <input type="text" id="referral-link" value="${refLink}" readonly  
                 style="padding:12px; text-align:center; border-radius:10px; border:1px dashed var(--primary-color); background:rgba(231,76,60,0.05); font-size:0.92rem; font-weight:600;">  
          <button id="copy-ref-link-btn" class="action-btn" style="width:100%; border-radius:10px; font-weight:700; font-size:0.95rem;">  
            ЁЯФЧ рж░рзЗржлрж╛рж░рзЗрж▓ рж▓рж┐ржЩрзНржХ ржХржкрж┐ ржХрж░рзБржи  
          </button>  
        </div>  
        <small style="margin-top:10px; opacity:0.75; text-align:center; font-size:0.85rem;">ЁЯУв ржЯрж┐ржкрж╕: ржмрзЗрж╢рж┐ рж╢рзЗржпрж╝рж╛рж░ ржХрж░рзБржи, ржмрзЗрж╢рж┐ ржЗржиржХрж╛ржо ржХрж░рзБржи!</small>  
      </div>`;  
  };  
  
  const renderWithdrawSection = () => {  
    const container = document.getElementById('withdraw-section'); let optionsHtml = '';  
    if (appConfig.withdrawMethods) {  
      appConfig.withdrawMethods.forEach(method => { optionsHtml += `<option value="${method.name}">${method.name} (ржирзНржпрзВржирждржо: ${method.min} ржЯрж╛ржХрж╛)</option>`; });  
    }  
  
    const minRefs = appConfig.minimumWithdrawReferrals || 0;  
    let referralNotice = '';  
    if (minRefs > 0) {  
      referralNotice = `<p style="font-size: 0.85rem; text-align: center; margin-bottom: 15px; opacity: 0.8;"><b>ржирзЛржЯ:</b> ржЙржЗржержбрзНрж░ ржХрж░рждрзЗ ржЖржкржирж╛рж░ ржЕржирзНрждржд <b>${minRefs}</b> ржЯрж┐ рж░рзЗржлрж╛рж░ ржкрзНрж░ржпрж╝рзЛржЬржиред</p>`;  
    }  
  
    container.innerHTML = `  
      <form id="withdraw-form" class="task-container" style="flex-direction: column; align-items: stretch; background: var(--surface-light); border-radius: 14px; padding: 18px; box-shadow: 0 3px 12px rgba(0,0,0,0.06);">  
        <h3 style="margin-bottom: 12px; color: var(--primary-color); font-weight: 700;">ЁЯТ╕ ржЙржЗржержбрзНрж░ ржЕржирзБрж░рзЛржз</h3>  
        ${referralNotice}  
        <div class="form-group" style="width:100%; margin-bottom: 14px;">  
          <label for="withdraw-method" style="font-weight:600; font-size:0.9rem; margin-bottom:6px; display:block;">ржЙржЗржержбрзНрж░ ржкржжрзНржзрждрж┐</label>  
          <select id="withdraw-method" required style="width:100%; padding:12px; border-radius:10px; border:1px solid var(--border-light); background:rgba(255,255,255,0.95); font-size:0.95rem;">${optionsHtml}</select>  
        </div>  
        <div class="form-group" style="width:100%; margin-bottom: 14px;">  
          <label for="account-number" style="font-weight:600; font-size:0.9rem; margin-bottom:6px; display:block;">ржЕрзНржпрж╛ржХрж╛ржЙржирзНржЯ ржиржорзНржмрж░ / ржЖржЗржбрж┐</label>  
          <input type="text" id="account-number" required placeholder="ржЙржжрж╛рж╣рж░ржг: 01XXXXXXXXX" style="width:100%; padding:12px; border-radius:10px; border:1px solid var(--border-light); font-size:0.95rem;">  
        </div>  
        <div class="form-group" style="width:100%; margin-bottom: 14px;">  
          <label for="amount" style="font-weight:600; font-size:0.9rem; margin-bottom:6px; display:block;">ржкрж░рж┐ржорж╛ржг (ржЯрж╛ржХрж╛)</label>  
          <input type="number" step="any" id="amount" required placeholder="ржирзНржпрзВржирждржо рж╕рзАржорж╛ ржЕржирзБрж╕рж░ржг ржХрж░рзБржи" style="width:100%; padding:12px; border-radius:10px; border:1px solid var(--border-light); font-size:0.95rem;">  
        </div>  
        <button type="submit" id="withdraw-submit-btn" class="action-btn" style="width:100%; margin-top:6px; border-radius:10px; font-weight:700; font-size:1rem;">ржЕржирзБрж░рзЛржз ржЬржорж╛ ржжрж┐ржи</button>  
        <p style="font-size:0.85rem; text-align:center; margin-top:15px; opacity:0.8;">  
          <b>ржирзЛржЯ:</b> ржЕржирзБрж░рзЛржз ржЬржорж╛ ржжрзЗржУрзЯрж╛рж░ ржкрж░ рзирзк ржШржирзНржЯрж╛рж░ ржоржзрзНржпрзЗ рж░рж┐ржнрж┐ржЙ рж╕ржорзНржкржирзНржи рж╣ржмрзЗред  
        </p>  
      </form>`;  
  };  
  
  const renderDynamicLinks = () => {  
    const container = document.getElementById('dynamic-links-container'); container.innerHTML = '';  
    if (appConfig.links) {  
      const links = [];  
      for (const key in appConfig.links) { links.push({key, ...appConfig.links[key]}); }  
      links.reverse();  
      links.forEach(link => {  
        const el = document.createElement('div'); el.className = 'task-container';  
        el.innerHTML = `  
          <img class="task-icon-img" src="${link.icon}" alt="icon" style="width:48px;height:48px;border-radius:12px;object-fit:cover;border:2px solid var(--primary-color);box-shadow:0 2px 6px rgba(0,0,0,0.08);">  
          <div class="task-info" style="flex-grow:1;">  
            <h3 style="font-size:1.05rem;font-weight:700;margin-bottom:4px;color:var(--primary-color);">${link.name}</h3>  
            <p style="font-size:0.9rem;opacity:0.8;">ржЖрж░ржУ ржЬрж╛ржирждрзЗ ржмрж╛ ржПржХрзНрж╕ржкрзНрж▓рзЛрж░ ржХрж░рждрзЗ ржХрзНрж▓рж┐ржХ ржХрж░рзБржи</p>  
          </div>  
          <button class="action-btn" onclick="window.Telegram.WebApp.openLink('${link.url}')" style="padding:10px 18px;border-radius:10px;font-weight:700;font-size:0.9rem;box-shadow:0 2px 10px rgba(231,76,60,0.25);">ЁЯМР ржнрж┐ржЬрж┐ржЯ</button>`;  
        container.appendChild(el);  
      });  
    }  
  };  
  
  initApp();  
});  
</script> 
<!-- <script>
// -----------------------------
// data-page ржЕрзНржпрж╛ржЯрзНрж░рж┐ржмрж┐ржЙржЯ ржХрзНрж▓рж┐ржХ ржЗржнрзЗржирзНржЯ
// -----------------------------
document.querySelectorAll('[data-page]').forEach(btn=>{
  btn.addEventListener('click', ()=>{
    const target = btn.getAttribute('data-page');
    document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
    document.getElementById(target).classList.add('active');
  });
});

document.addEventListener('DOMContentLoaded', () => {
  const tg = window.Telegram.WebApp;

  /* ---------- NEW: Brand Loader Controller ---------- */
  let lottiePlayer = null;
  function startBrandLoader() {
    const box = document.getElementById('lottie-box');
    const fb  = document.getElementById('fallback-bounce');
    try {
      lottiePlayer = lottie.loadAnimation({
        container: box,
        renderer: 'svg',
        loop: true,
        autoplay: true,
        // ЁЯСЙ ржЪрж╛ржЗрж▓рзЗ ржирж┐ржЬрзЗрж░ рж▓рзЛржЯрж┐ JSON ржжрж┐ржи
        path: 'https://assets9.lottiefiles.com/packages/lf20_j1adxtyb.json'
      });
      fb.style.display = 'none';
    } catch(e) {
      fb.style.display = 'flex'; // fallback bounce
    }
  }
  function stopBrandLoader() {
    try { lottiePlayer && lottiePlayer.destroy && lottiePlayer.destroy(); } catch(e){}
    const loader = document.getElementById('app-loader');
    loader.classList.add('loader-hide');
    setTimeout(()=> loader.style.display='none', 360);
  }
  // Loader text helper (percent тЖТ human text)
  const loaderTextEl = document.getElementById('loader-text');
  const updateProgress = (p) => {
    if (!loaderTextEl) return;
    if (p < 30) loaderTextEl.textContent = 'BootEX ржкрзНрж░рж╕рзНрждрзБрждрж┐ ржЪрж▓ржЫрзЗтАж';
    else if (p < 60) loaderTextEl.textContent = 'ржбрзЗржЯрж╛ рж╕рж┐ржЩрзНржХ рж╣ржЪрзНржЫрзЗтАж';
    else if (p < 90) loaderTextEl.textContent = 'ржкрзНрж░рж╛ржпрж╝ рж╢рзЗрж╖тАж';
    else loaderTextEl.textContent = 'рж░рзЗржбрж┐!';
  };
  startBrandLoader();
  /* ---------- /NEW ---------- */

  // For Firebase JS SDK v7.20.0 and later, measurementId is optional
  const firebaseConfig = {
    apiKey: "AIzaSyBqtUdglrrNNf68-UEHSSvkSCnLy2SNFgo",
    authDomain: "botbit-a30f3.firebaseapp.com",
    databaseURL: "https://botbit-a30f3-default-rtdb.firebaseio.com",
    projectId: "botbit-a30f3",
    storageBucket: "botbit-a30f3.firebasestorage.app",
    messagingSenderId: "662684170149",
    appId: "1:662684170149:web:4d3a2222d28024b3f51a4c",
    measurementId: "G-V03WQ1FBT8"
  };

  let appConfig = {}; let userState = {}; let tgUser = {}; let earningWalletBalance = 0;
  let leaderboardData = { referral: [], earning: [] };
  let userTransactions = [];

  const popup = document.getElementById('popup');
  const popupBody = document.getElementById('popup-body');
  const showPopup = (content) => { popupBody.innerHTML = content; popup.style.display = 'flex'; };
  const closePopup = () => { popup.style.display = 'none'; };

  const loadAdSdk = (zoneId) => {
    if (!zoneId) { console.error("Ad Zone ID is missing from Firebase config!"); return; }
    if (document.querySelector(`script[data-zone='${zoneId}']`)) return;
    const script = document.createElement('script');
    script.src = `//libtl.com/sdk.js`;
    script.setAttribute('data-zone', zoneId);
    script.setAttribute('data-sdk', `show_${zoneId}`);
    script.async = true;
    document.body.appendChild(script);
  };

  const initApp = async () => {
    tg.ready(); tg.expand();
    document.body.className = `${tg.colorScheme}-theme`;
    tgUser = tg.initDataUnsafe.user;
    if (!tgUser || !tgUser.id) { tg.showAlert("ржЗржЙржЬрж╛рж░ ржбрж╛ржЯрж╛ ржкрж╛ржУржпрж╝рж╛ ржпрж╛ржпрж╝ржирж┐ред"); tg.close(); return; }

    try {
      updateProgress(10); firebase.initializeApp(firebaseConfig); const db = firebase.database();
      updateProgress(20);

      const configSnapshot = await db.ref('config').once('value');
      appConfig = configSnapshot.val() || {};
      updateProgress(40);

      await loadUserData(db); // depends on appConfig
      updateProgress(60);

      const referralBoardPromise = db.ref('users').orderByChild('referrals').limitToLast(10).once('value');
      const earningBoardPromise = db.ref('users').orderByChild('totalEarned').limitToLast(10).once('value');
      const historyPromise = loadTransactionHistory(db);

      const [referralBoardSnap, earningBoardSnap] = await Promise.all([referralBoardPromise, earningBoardPromise, historyPromise]);
      updateProgress(80);

      referralBoardSnap.forEach(child => { leaderboardData.referral.push(child.val()); });
      earningBoardSnap.forEach(child => { leaderboardData.earning.push(child.val()); });
      leaderboardData.referral.reverse(); leaderboardData.earning.reverse();
      updateProgress(90);

      loadAdSdk(appConfig.adZoneId);
      earningWalletBalance = parseFloat(localStorage.getItem(`earningWallet_${tgUser.id}`) || '0');

      renderUI(); setupNavigation(); setupEventListeners();
      updateProgress(100);

      setTimeout(() => {
        stopBrandLoader();
        document.getElementById('app').style.display = 'block';
        if (appConfig.welcomeMessage && !userState.welcomed) {
          showPopup(`<h2>рж╕рзНржмрж╛ржЧрждржо!</h2><p>${appConfig.welcomeMessage}</p><button class="popup-close-btn">ржЪрж╛рж▓рж┐ржпрж╝рзЗ ржпрж╛ржи</button>`);
          db.ref(`users/${tgUser.id}/welcomed`).set(true);
        }
      }, 300);
    } catch (error) {
      console.error("Initialization failed:", error);
      tg.showAlert("ржЕрзНржпрж╛ржк ржбрж╛ржЯрж╛ рж▓рзЛржб рж╣ржпрж╝ржирж┐ред ржЕржирзБржЧрзНрж░рж╣ ржХрж░рзЗ ржЖржмрж╛рж░ ржЪрзЗрж╖рзНржЯрж╛ ржХрж░рзБржиред");
    }
  };

  const loadUserData = async (db) => {
    const userRef = db.ref(`users/${tgUser.id}`);
    const snapshot = await userRef.once('value');
    let userData = snapshot.val();

    if (!userData) {
      const startParam = tg.initDataUnsafe.start_param;
      const referralId = (startParam && !isNaN(startParam)) ? startParam : null;

      userData = {
        id: tgUser.id, firstName: tgUser.first_name || '', lastName: tgUser.last_name || '',
        username: tgUser.username || '', photoUrl: tgUser.photo_url || '',
        balance: 0, referrals: 0, referredBy: referralId, totalEarned: 0, lifetimeAdCount: 0,
        lastAdWatchDate: '1970-01-01', dailyAdCount: 0, breakUntil: 0, completedTasks: {}, welcomed: false
      };
      await userRef.set(userData);

      if (referralId && referralId != tgUser.id) {
        const referrerRef = db.ref(`users/${referralId}`);
        const bonusAmount = parseFloat(appConfig.referralBonus || 0);
        if (bonusAmount > 0) {
          await referrerRef.transaction(currentData => {
            if (currentData) {
              currentData.balance = (currentData.balance || 0) + bonusAmount;
              currentData.referrals = (currentData.referrals || 0) + 1;
            }
            return currentData;
          });
        } else {
          await referrerRef.child('referrals').set(firebase.database.ServerValue.increment(1));
        }
      }
    }

    const today = new Date().toISOString().slice(0, 10);
    if (userData.lastAdWatchDate !== today) {
      userData.dailyAdCount = 0; userData.lastAdWatchDate = today;
      await userRef.update({ dailyAdCount: 0, lastAdWatchDate: today });
    }
    userState = userData;
  };

  const loadTransactionHistory = async (db) => {
    userTransactions = [];
    const statuses = ['pending', 'completed', 'rejected'];
    const historyPromises = statuses.map(status => db.ref(`withdrawals/${status}`).orderByChild('userId').equalTo(tgUser.id).once('value'));
    const snapshots = await Promise.all(historyPromises);
    snapshots.forEach(snap => { snap.forEach(childSnap => { userTransactions.push(childSnap.val()); }); });
    userTransactions.sort((a, b) => b.timestamp - a.timestamp);
  };

  const renderUI = () => {
    document.getElementById('user-photo').src = userState.photoUrl || 'https://via.placeholder.com/80';
    document.getElementById('user-name').textContent = `${userState.firstName} ${userState.lastName}`;
    document.getElementById('user-balance').textContent = (userState.balance || 0).toFixed(2);
    document.getElementById('daily-ads-watched').textContent = `${userState.dailyAdCount || 0} / ${appConfig.dailyAdLimit || 0}`;
    document.getElementById('referral-count').textContent = userState.referrals || 0;
    document.getElementById('total-ads-watched').textContent = userState.lifetimeAdCount || 0;
    document.getElementById('total-earned').textContent = (userState.totalEarned || 0).toFixed(2);
    document.getElementById('earning-wallet-balance').textContent = earningWalletBalance.toFixed(2);
    document.getElementById('move-to-balance-btn').disabled = earningWalletBalance < 100;

    renderAdTask();
    renderAdProgress();
    renderDynamicTasks();
    renderReferralSection();
    renderWithdrawSection();
    renderEarningsGraph();
    renderDynamicLinks();
  };

  const renderAdProgress = () => {
    const container = document.getElementById('ad-progress-container');
    const dailyLimit = appConfig.dailyAdLimit || 1;
    const watchedCount = userState.dailyAdCount || 0;
    const percentage = (watchedCount / dailyLimit) * 100;
    container.innerHTML = `
      <div class="progress-info">
        <span>ржжрзИржирж┐ржХ ржмрж┐ржЬрзНржЮрж╛ржкржи ржЕржЧрзНрж░ржЧрждрж┐</span>
        <span>${watchedCount} / ${dailyLimit}</span>
      </div>
      <div class="progress-bar-bg"><div class="progress-bar-fg" style="width: ${percentage}%;"></div></div>`;
  };

  const renderEarningsGraph = async () => {
    const chartEl = document.getElementById('earnings-chart');
    const labelsEl = document.getElementById('earnings-chart-labels');
    chartEl.innerHTML = ''; labelsEl.innerHTML = '';
    const today = new Date(); const dates = [];
    for (let i = 6; i >= 0; i--) { const date = new Date(today); date.setDate(today.getDate() - i); dates.push(date.toISOString().slice(0, 10)); }
    const earningsPromises = dates.map(date => firebase.database().ref(`userEarnings/${tgUser.id}/${date}`).once('value'));
    const snapshots = await Promise.all(earningsPromises);
    const earningsData = snapshots.map(snap => snap.val() || 0);
    const maxEarning = Math.max(...earningsData, 1);
    earningsData.forEach((earning, index) => {
      const height = (earning / maxEarning) * 100;
      const dateLabel = new Date(dates[index]).toLocaleDateString('bn-BD', { day: 'numeric' });
      chartEl.innerHTML += `<div class="bar" style="height: ${height}%;"><span class="tooltip">${earning.toFixed(2)} ржЯрж╛ржХрж╛</span></div>`;
      labelsEl.innerHTML += `<span>${dateLabel}</span>`;
    });
  };

  const handleWatchAd = async () => {
    if (userState.dailyAdCount >= appConfig.dailyAdLimit) { tg.showAlert("ржжрзИржирж┐ржХ ржмрж┐ржЬрзНржЮрж╛ржкржи ржжрзЗржЦрж╛рж░ рж╕рзАржорж╛ ржкрзВрж░рзНржг рж╣ржпрж╝рзЗржЫрзЗред"); return; }
    const now = Date.now();
    if (userState.breakUntil && now < userState.breakUntil) {
      const remaining = Math.ceil((userState.breakUntil - now) / 60000);
      tg.showAlert(`ржЕржирзБржЧрзНрж░рж╣ ржХрж░рзЗ ржЖрж░ржУ ${remaining} ржорж┐ржирж┐ржЯ ржЕржкрзЗржХрзНрж╖рж╛ ржХрж░рзБржиред`); return;
    }

    const adFunction = window['show_' + appConfig.adZoneId];
    if (typeof adFunction !== 'function') {
      tg.showAlert("ржмрж┐ржЬрзНржЮрж╛ржкржи ржирзЗржЯржУржпрж╝рж╛рж░рзНржХ ржкрзНрж░рж╕рзНрждрзБржд ржиржпрж╝ред ржХржпрж╝рзЗржХ рж╕рзЗржХрзЗржирзНржб ржкрж░ ржЖржмрж╛рж░ ржЪрзЗрж╖рзНржЯрж╛ ржХрж░рзБржиред"); return;
    }

    showPopup(`<div class="popup-loader"><div class="spinner"></div></div><h2>ржмрж┐ржЬрзНржЮрж╛ржкржи рж▓рзЛржб рж╣ржЪрзНржЫрзЗ</h2><p>ржжржпрж╝рж╛ ржХрж░рзЗ ржПржХржЯрзБ ржЕржкрзЗржХрзНрж╖рж╛ ржХрж░рзБржитАж</p>`);

    try {
      await adFunction();
      closePopup();
      const adValue = appConfig.adValue || 0;

      earningWalletBalance += adValue;
      localStorage.setItem(`earningWallet_${tgUser.id}`, earningWalletBalance.toString());

      userState.dailyAdCount++;
      userState.lifetimeAdCount++;
      userState.totalEarned = (userState.totalEarned || 0) + adValue;

      const db = firebase.database(); const userRef = db.ref(`users/${tgUser.id}`);
      const updates = {};
      updates.dailyAdCount = userState.dailyAdCount;
      updates.lifetimeAdCount = userState.lifetimeAdCount;
      updates.totalEarned = userState.totalEarned;
      if ((userState.dailyAdCount) % appConfig.adsPerBreak === 0 && appConfig.adsPerBreak > 0) {
        updates.breakUntil = Date.now() + (appConfig.breakDuration * 60000);
        userState.breakUntil = updates.breakUntil;
      }
      await userRef.update(updates);

      const today = new Date().toISOString().slice(0, 10);
      await db.ref(`userEarnings/${tgUser.id}/${today}`).set(firebase.database.ServerValue.increment(adValue));

      tg.HapticFeedback.notificationOccurred('success');
      tg.showAlert(`+${adValue.toFixed(2)} ржЯрж╛ржХрж╛ ржЖржкржирж╛рж░ ржЖрж░рзНржирж┐ржВ ржУржпрж╝рж╛рж▓рзЗржЯрзЗ ржпрзБржХрзНржд рж╣ржпрж╝рзЗржЫрзЗред`);

      renderUI();

    } catch (error) {
      console.error("Ad failed to load:", error);
      closePopup();
      tg.showAlert("ржмрж┐ржЬрзНржЮрж╛ржкржи рж▓рзЛржб ржХрж░рж╛ ржпрж╛ржпрж╝ржирж┐ред ржЖржмрж╛рж░ ржЪрзЗрж╖рзНржЯрж╛ ржХрж░рзБржиред");
    }
  };

  const handleMoveToBalance = async () => {
    if(earningWalletBalance < 100) { tg.showAlert("ржорзЗржЗржи ржмрзНржпрж╛рж▓рзЗржирзНрж╕рзЗ ржирж┐рждрзЗ ржирзНржпрзВржирждржо рззрзжрзж ржЯрж╛ржХрж╛ ржкрзНрж░ржпрж╝рзЛржЬржиред"); return; }
    const btn = document.getElementById('move-to-balance-btn'); btn.disabled = true; btn.textContent = 'рж╕рзНржерж╛ржирж╛ржирзНрждрж░ рж╣ржЪрзНржЫрзЗтАж';
    try {
      const db = firebase.database();
      await db.ref(`users/${tgUser.id}/balance`).set(firebase.database.ServerValue.increment(earningWalletBalance));
      userState.balance += earningWalletBalance;
      earningWalletBalance = 0;
      localStorage.setItem(`earningWallet_${tgUser.id}`, '0');
      tg.HapticFeedback.notificationOccurred('success');
      tg.showAlert("рж╕ржлрж▓ржнрж╛ржмрзЗ ржорзЗржЗржи ржмрзНржпрж╛рж▓рзЗржирзНрж╕рзЗ рж╕рзНржерж╛ржирж╛ржирзНрждрж░ рж╣ржпрж╝рзЗржЫрзЗ!");
    } catch(error) {
      console.error("Failed to move balance:", error);
      tg.showAlert("рж╕рзНржерж╛ржирж╛ржирзНрждрж░ ржмрзНржпрж░рзНрже рж╣ржпрж╝рзЗржЫрзЗред ржЖржмрж╛рж░ ржЪрзЗрж╖рзНржЯрж╛ ржХрж░рзБржиред");
    } finally { btn.textContent = 'ржорзЗржЗржи ржмрзНржпрж╛рж▓рзЗржирзНрж╕рзЗ ржирж┐ржи'; renderUI(); }
  };

  const renderWithdrawalHistory = () => {
    const listEl = document.getElementById('withdrawal-history-list');
    if (userTransactions.length === 0) { listEl.innerHTML = '<p>ржХрзЛржиржУ ржЙржЗржержбрзНрж░ рж╣рж┐рж╕рзНржЯрзНрж░рж┐ ржкрж╛ржУржпрж╝рж╛ ржпрж╛ржпрж╝ржирж┐ред</p>'; return; }
    listEl.innerHTML = userTransactions.map(item => `
      <div class="history-item">
        <div class="history-details">
          <p>${item.amount.toFixed(2)} ржЯрж╛ржХрж╛ - ${item.method}</p>
          <small>${new Date(item.timestamp).toLocaleString('bn-BD')}</small>
        </div>
        <span class="history-status status-${item.status}">${item.status}</span>
      </div>`).join('');
  };

  const setupNavigation = () => {
    const navButtons = document.querySelectorAll('.nav-btn'); const pages = document.querySelectorAll('.page');
    navButtons.forEach(button => {
      button.addEventListener('click', () => {
        const pageId = button.dataset.page;
        pages.forEach(page => page.classList.remove('active'));
        document.getElementById(pageId).classList.add('active');
        navButtons.forEach(btn => btn.classList.remove('active'));
        button.classList.add('active');
        if (pageId === 'profile-page') { renderWithdrawalHistory(); }
        if (pageId === 'leaderboard-page') { renderLeaderboard(); }
      });
    });
  };

  const setupEventListeners = () => {
    popup.addEventListener('click', (e) => { if (e.target.classList.contains('popup-close-btn') || e.target.id === 'popup') closePopup(); });
    document.querySelector('.leaderboard-toggle').addEventListener('click', (e) => {
      if(e.target.classList.contains('toggle-btn')) {
        document.querySelectorAll('.toggle-btn').forEach(b => b.classList.remove('active'));
        e.target.classList.add('active');
        renderLeaderboard();
      }
    });
    document.getElementById('dynamic-tasks-container').addEventListener('click', (e) => handleClaimTask(e));
    document.getElementById('profile-page').addEventListener('submit', (e) => handleWithdraw(e));
    document.getElementById('referral-section').addEventListener('click', (e) => { if(e.target.id === 'copy-ref-link-btn') copyReferralLink(); });
    document.getElementById('move-to-balance-btn').addEventListener('click', handleMoveToBalance);
  };

  const renderAdTask = () => {
    const container = document.getElementById('ad-task-container');
    const now = Date.now();
    const onBreak = userState.breakUntil && now < userState.breakUntil;
    const limitReached = userState.dailyAdCount >= appConfig.dailyAdLimit;
    let html = '';
    if (onBreak) {
      const remaining = Math.ceil((userState.breakUntil - now) / 60000);
      html = `<div class="task-container">
        <img class="task-icon-img" src="https://img.icons8.com/ios-filled/100/hourglass.png" alt="icon">
        <div class="task-info"><h3>ржмрж┐рж░рждрж┐ ржЪрж▓ржЫрзЗ</h3><p>ржЕржирзБржЧрзНрж░рж╣ ржХрж░рзЗ ржЖрж░ржУ ${remaining} ржорж┐ржирж┐ржЯ ржЕржкрзЗржХрзНрж╖рж╛ ржХрж░рзБржиред</p></div>
        <button class="action-btn" disabled>ржЕржкрзЗржХрзНрж╖ржорж╛ржи</button>
      </div>`;
    } else if (limitReached) {
      html = `<div class="task-container">
        <img class="task-icon-img" src="https://img.icons8.com/ios-filled/100/stop-circled.png" alt="icon">
        <div class="task-info"><h3>ржжрзИржирж┐ржХ рж╕рзАржорж╛ ржкрзВрж░рзНржг</h3><p>ржЖржЧрж╛ржорзАржХрж╛рж▓ ржЖржмрж╛рж░ ржЪрзЗрж╖рзНржЯрж╛ ржХрж░рзБржиред</p></div>
        <button class="action-btn" disabled>рж╕рзАржорж╛</button>
      </div>`;
    } else {
      html = `<div class="task-container">
        <img class="task-icon-img" src="https://img.icons8.com/ios-filled/100/play-button-circled.png" alt="icon">
        <div class="task-info"><h3>ржкрзБрж░рж╕рзНржХрж╛рж░ ржмрж┐ржЬрзНржЮрж╛ржкржи ржжрзЗржЦрзБржи</h3><p>ржкрзНрж░рждрж┐ ржмрж┐ржЬрзНржЮрж╛ржкржирзЗ ржЙржкрж╛рж░рзНржЬржи: ${appConfig.adValue || 0} ржЯрж╛ржХрж╛</p></div>
        <button id="watch-ad-btn" class="action-btn">ржмрж┐ржЬрзНржЮрж╛ржкржи ржжрзЗржЦрзБржи</button>
      </div>`;
    }
    container.innerHTML = html;
    if (!onBreak && !limitReached) { document.getElementById('watch-ad-btn').addEventListener('click', handleWatchAd); }
  };

  const handleClaimTask = async (e) => {
    if (e.target.classList.contains('action-btn') && e.target.dataset.taskId) {
      const taskId = e.target.dataset.taskId;
      const task = appConfig.tasks[taskId];
      if (!task || (userState.completedTasks && userState.completedTasks[taskId])) { tg.showAlert('ржПржЗ ржмрзЛржирж╛рж╕ржЯрж┐ ржЖржкржирж┐ ржЗрждрж┐ржоржзрзНржпрзЗржЗ ржирж┐ржпрж╝рзЗржЫрзЗржиред'); return; }
      tg.openLink(e.target.dataset.taskUrl);
      e.target.disabled = true; e.target.textContent = 'ржХрзНрж▓рзЗржЗржо рж╣ржЪрзНржЫрзЗтАж';
      setTimeout(async () => {
        try {
          const db = firebase.database(); const userRef = db.ref(`users/${tgUser.id}`);
          await userRef.child(`completedTasks/${taskId}`).set(true);
          await userRef.child('balance').set(firebase.database.ServerValue.increment(task.reward));
          userState.balance += task.reward;
          if (!userState.completedTasks) userState.completedTasks = {};
          userState.completedTasks[taskId] = true;
          tg.HapticFeedback.notificationOccurred('success');
          tg.showAlert(`ржзржирзНржпржмрж╛ржж! ржЖржкржирж┐ ${task.reward} ржЯрж╛ржХрж╛ ржмрзЛржирж╛рж╕ ржкрзЗржпрж╝рзЗржЫрзЗржиред`);
          renderUI();
        } catch (error) {
          tg.showAlert('ржмрзЛржирж╛рж╕ ржХрзНрж▓рзЗржЗржо ржХрж░рж╛ ржпрж╛ржпрж╝ржирж┐ред ржЖржмрж╛рж░ ржЪрзЗрж╖рзНржЯрж╛ ржХрж░рзБржиред');
          e.target.disabled = false; e.target.textContent = 'ржмрзЛржирж╛рж╕ ржХрзНрж▓рзЗржЗржо ржХрж░рзБржи';
        }
      }, 5000);
    }
  };

  const handleWithdraw = async (e) => {
    if(e.target.id !== 'withdraw-form') return;
    e.preventDefault();

    const minRefsRequired = appConfig.minimumWithdrawReferrals || 0;
    const userReferrals = userState.referrals || 0;
    if (minRefsRequired > 0 && userReferrals < minRefsRequired) {
      tg.showAlert(`ржЙржЗржержбрзНрж░ ржмрзНржпрж░рзНрже рж╣ржпрж╝рзЗржЫрзЗред ржЙржЗржержбрзНрж░ ржХрж░рж╛рж░ ржЬржирзНржп ржЕржирзНрждржд ${minRefsRequired} ржЬржи рж░рзЗржлрж╛рж░рж╛рж▓ ржкрзНрж░ржпрж╝рзЛржЬржиред ржмрж░рзНрждржорж╛ржирзЗ ржЖржкржирж╛рж░ рж░рзЗржлрж╛рж░рж╛рж▓ рж╕ржВржЦрзНржпрж╛ ${userReferrals} ржЬржиред`);
      return;
    }

    const methodEl = document.getElementById('withdraw-method');
    const accountNumber = document.getElementById('account-number').value;
    const amount = parseFloat(document.getElementById('amount').value);
    const selectedMethod = appConfig.withdrawMethods.find(m => m.name === methodEl.value);

    if (isNaN(amount) || amount <= 0) { tg.showAlert("ржжржпрж╝рж╛ ржХрж░рзЗ ржПржХржЯрж┐ ржмрзИржз ржкрж░рж┐ржорж╛ржг рж▓рж┐ржЦрзБржиред"); return; }
    if (!selectedMethod) { tg.showAlert("ржнрзБрж▓ ржЙржЗржержбрзНрж░ ржкржжрзНржзрждрж┐ред"); return; }
    if (amount < selectedMethod.min) { tg.showAlert(`${selectedMethod.name} ржкржжрзНржзрждрж┐рждрзЗ ржирзНржпрзВржирждржо ржЙржЗржержбрзНрж░ ${selectedMethod.min} ржЯрж╛ржХрж╛ред`); return; }
    if (amount > userState.balance) { tg.showAlert("ржЖржкржирж╛рж░ ржпржерзЗрж╖рзНржЯ ржмрзНржпрж╛рж▓рзЗржирзНрж╕ ржирзЗржЗред"); return; }

    const btn = document.getElementById('withdraw-submit-btn'); btn.disabled = true; btn.textContent = 'ржЬржорж╛ рж╣ржЪрзНржЫрзЗтАж';
    const db = firebase.database();
    try {
      const userRef = db.ref(`users/${tgUser.id}`);
      userState.balance -= amount;
      renderUI();

      await userRef.child('balance').set(firebase.database.ServerValue.increment(-amount));
      const reqId = db.ref('withdrawals/pending').push().key;
      const newRequest = {
        id: reqId, userId: tgUser.id, userName: `${userState.firstName} ${userState.lastName}`,
        method: selectedMethod.name, account: accountNumber, amount: amount,
        status: 'pending', timestamp: firebase.database.ServerValue.TIMESTAMP
      };
      await db.ref(`withdrawals/pending/${reqId}`).set(newRequest);

      userTransactions.unshift(newRequest);
      renderWithdrawalHistory();

      tg.HapticFeedback.notificationOccurred('success');
      tg.showAlert("ржЯрж╛ржХрж╛ рждрзЛрж▓рж╛рж░ ржЕржирзБрж░рзЛржз рж╕ржлрж▓ржнрж╛ржмрзЗ ржЬржорж╛ ржжрзЗржУржпрж╝рж╛ рж╣ржпрж╝рзЗржЫрзЗ!");
      document.getElementById('withdraw-form').reset();
    } catch (error) {
      userState.balance += amount;
      tg.HapticFeedback.notificationOccurred('error');
      tg.showAlert("ржЕржирзБрж░рзЛржз ржЬржорж╛ ржмрзНржпрж░рзНрже рж╣ржпрж╝рзЗржЫрзЗред ржЖржкржирж╛рж░ ржмрзНржпрж╛рж▓рзЗржирзНрж╕ ржкрзВрж░рзНржмрж╛ржмрж╕рзНржерж╛ржпрж╝ ржлрж┐рж░рж┐ржпрж╝рзЗ ржжрзЗржпрж╝рж╛ рж╣ржпрж╝рзЗржЫрзЗред");
    } finally {
      renderUI();
      btn.disabled = false;
      btn.textContent = 'ржЕржирзБрж░рзЛржз ржЬржорж╛ ржжрж┐ржи';
    }
  };

  const copyReferralLink = () => {
    const refLinkInput = document.getElementById('referral-link');
    refLinkInput.select();
    refLinkInput.setSelectionRange(0, 99999);
    try {
      navigator.clipboard.writeText(refLinkInput.value).then(() => {
        tg.HapticFeedback.notificationOccurred('success');
        tg.showAlert("рж░рзЗржлрж╛рж░рзЗрж▓ рж▓рж┐ржЩрзНржХ ржХржкрж┐ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗ!");
      });
    } catch (err) {
      document.execCommand('copy');
      tg.HapticFeedback.notificationOccurred('success');
      tg.showAlert("рж░рзЗржлрж╛рж░рзЗрж▓ рж▓рж┐ржЩрзНржХ ржХржкрж┐ ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗ!");
    }
  };

  const renderLeaderboard = () => {
    const activeBoard = document.querySelector('.toggle-btn.active').dataset.board;
    const listEl = document.getElementById(activeBoard === 'referral' ? 'referral-leaderboard-list' : 'earning-leaderboard-list');
    const data = leaderboardData[activeBoard];
    document.getElementById('referral-board').style.display = activeBoard === 'referral' ? 'block' : 'none';
    document.getElementById('earning-board').style.display = activeBoard === 'earning' ? 'block' : 'none';
    listEl.innerHTML = '';
    if (data.length === 0) { listEl.innerHTML = '<li>ржХрзЛржи рждржерзНржп ржирзЗржЗред</li>'; return; }
    data.forEach((user, index) => {
      const score = activeBoard === 'referral' ? (user.referrals || 0) : (user.totalEarned || 0).toFixed(2);
      const item = document.createElement('li'); item.className = 'leaderboard-item';
      item.innerHTML = `
        <span class="rank" style="width:36px;text-align:center;font-weight:800;color:var(--primary-color);font-size:1rem;">ЁЯПЕ #${index + 1}</span>
        <img src="${user.photoUrl || 'https://via.placeholder.com/50'}" alt="User" style="width:46px;height:46px;border-radius:50%;object-fit:cover;border:2px solid var(--primary-color);box-shadow:0 2px 8px rgba(231,76,60,0.2);margin-right:10px;">
        <span class="leaderboard-name" style="flex-grow:1;font-weight:600;font-size:0.95rem;">${user.firstName}</span>
        <span class="leaderboard-score" style="font-weight:700;color:var(--secondary-color);font-size:1rem;">${score}</span>`;
      listEl.appendChild(item);
    });
  };

  const renderDynamicTasks = () => {
    const container = document.getElementById('dynamic-tasks-container'); container.innerHTML = '';
    if (appConfig.tasks) {
      const tasks = [];
      for(const key in appConfig.tasks) { tasks.push({key, ...appConfig.tasks[key]}); }
      tasks.reverse();
      tasks.forEach(task => {
        const isCompleted = userState.completedTasks && userState.completedTasks[task.key];
        const el = document.createElement('div'); el.className = 'task-container';
        el.innerHTML = `
          <img class="task-icon-img" src="${task.icon}" alt="icon"
               style="width:50px;height:50px;border-radius:12px;object-fit:cover;border:2px solid var(--primary-color);box-shadow:0 2px 8px rgba(0,0,0,0.08);">
          <div class="task-info" style="flex-grow:1;">
            <h3 style="font-size:1.05rem;font-weight:700;margin-bottom:5px;color:var(--primary-color);">${task.name}</h3>
            <p style="font-size:0.9rem;opacity:0.85;">ЁЯОБ рж╕ржорзНржкржирзНржи ржХрж░рж▓рзЗ ржкрж╛ржмрзЗржи <b>${task.reward} ржЯрж╛ржХрж╛</b> ржмрзЛржирж╛рж╕</p>
          </div>
          <button class="action-btn" data-task-id="${task.key}" data-task-url="${task.url}" ${isCompleted ? 'disabled' : ''}
                  style="padding:10px 18px;border-radius:10px;font-weight:700;font-size:0.9rem;box-shadow:0 2px 10px rgba(231,76,60,0.25);">
            ${isCompleted ? 'тЬЕ ржирзЗржУржпрж╝рж╛ рж╣ржпрж╝рзЗржЫрзЗ' : 'ЁЯОп ржмрзЛржирж╛рж╕ ржирж┐ржи'}
          </button>`;
        container.appendChild(el);
      });
    }
  };

  const renderReferralSection = () => {
    const container = document.getElementById('referral-section');
    const refLink = `https://t.me/${appConfig.botUsername}/app?startapp=${tgUser.id}`;
    container.innerHTML = `
      <div class="task-container" style="flex-direction: column; align-items: stretch; background: var(--surface-light); border-radius: 14px; padding: 18px; box-shadow: 0 3px 12px rgba(0,0,0,0.06); border: 1px solid var(--border-light);">
        <h3 style="margin-bottom: 8px; color: var(--primary-color); font-weight: 700; font-size: 1.1rem;">ЁЯдЭ рж░рзЗржлрж╛рж░ ржХрж░рзЗ ржЖржпрж╝ ржХрж░рзБржи</h3>
        <p style="font-size: 0.95rem; margin-bottom: 14px; opacity: 0.85;">
          ржЖржкржирж╛рж░ ржмржирзНржзрзБржжрзЗрж░ ржЖржоржирзНрждрзНрж░ржг ржХрж░рзБржи ржПржмржВ ржкрзНрж░рждрж┐ рж░рзЗржлрж╛рж░рзЗрж▓рзЗ <b>${appConfig.referralBonus || 0} ржЯрж╛ржХрж╛</b> ржЙржкрж╛рж░рзНржЬржи ржХрж░рзБржиред
        </p>
        <div style="display:flex; flex-direction:column; gap:10px;">
          <input type="text" id="referral-link" value="${refLink}" readonly
                 style="padding:12px; text-align:center; border-radius:10px; border:1px dashed var(--primary-color); background:rgba(231,76,60,0.05); font-size:0.92rem; font-weight:600;">
          <button id="copy-ref-link-btn" class="action-btn" style="width:100%; border-radius:10px; font-weight:700; font-size:0.95rem;">
            ЁЯФЧ рж░рзЗржлрж╛рж░рзЗрж▓ рж▓рж┐ржЩрзНржХ ржХржкрж┐ ржХрж░рзБржи
          </button>
        </div>
        <small style="margin-top:10px; opacity:0.75; text-align:center; font-size:0.85rem;">ЁЯУв ржЯрж┐ржкрж╕: ржмрзЗрж╢рж┐ рж╢рзЗржпрж╝рж╛рж░ ржХрж░рзБржи, ржмрзЗрж╢рж┐ ржЗржиржХрж╛ржо ржХрж░рзБржи!</small>
      </div>`;
  };

  const renderWithdrawSection = () => {
    const container = document.getElementById('withdraw-section'); let optionsHtml = '';
    if (appConfig.withdrawMethods) {
      appConfig.withdrawMethods.forEach(method => { optionsHtml += `<option value="${method.name}">${method.name} (ржирзНржпрзВржирждржо: ${method.min} ржЯрж╛ржХрж╛)</option>`; });
    }

    const minRefs = appConfig.minimumWithdrawReferrals || 0;
    let referralNotice = '';
    if (minRefs > 0) {
      referralNotice = `<p style="font-size: 0.85rem; text-align: center; margin-bottom: 15px; opacity: 0.8;"><b>ржирзЛржЯ:</b> ржЙржЗржержбрзНрж░ ржХрж░рждрзЗ ржЖржкржирж╛рж░ ржЕржирзНрждржд <b>${minRefs}</b> ржЯрж┐ рж░рзЗржлрж╛рж░ ржкрзНрж░ржпрж╝рзЛржЬржиред</p>`;
    }

    container.innerHTML = `
      <form id="withdraw-form" class="task-container" style="flex-direction: column; align-items: stretch; background: var(--surface-light); border-radius: 14px; padding: 18px; box-shadow: 0 3px 12px rgba(0,0,0,0.06);">
        <h3 style="margin-bottom: 12px; color: var(--primary-color); font-weight: 700;">ЁЯТ╕ ржЙржЗржержбрзНрж░ ржЕржирзБрж░рзЛржз</h3>
        ${referralNotice}
        <div class="form-group" style="width:100%; margin-bottom: 14px;">
          <label for="withdraw-method" style="font-weight:600; font-size:0.9rem; margin-bottom:6px; display:block;">ржЙржЗржержбрзНрж░ ржкржжрзНржзрждрж┐</label>
          <select id="withdraw-method" required style="width:100%; padding:12px; border-radius:10px; border:1px solid var(--border-light); background:rgba(255,255,255,0.95); font-size:0.95rem;">${optionsHtml}</select>
        </div>
        <div class="form-group" style="width:100%; margin-bottom: 14px;">
          <label for="account-number" style="font-weight:600; font-size:0.9rem; margin-bottom:6px; display:block;">ржЕрзНржпрж╛ржХрж╛ржЙржирзНржЯ ржиржорзНржмрж░ / ржЖржЗржбрж┐</label>
          <input type="text" id="account-number" required placeholder="ржЙржжрж╛рж╣рж░ржг: 01XXXXXXXXX" style="width:100%; padding:12px; border-radius:10px; border:1px solid var(--border-light); font-size:0.95rem;">
        </div>
        <div class="form-group" style="width:100%; margin-bottom: 14px;">
          <label for="amount" style="font-weight:600; font-size:0.9rem; margin-bottom:6px; display:block;">ржкрж░рж┐ржорж╛ржг (ржЯрж╛ржХрж╛)</label>
          <input type="number" step="any" id="amount" required placeholder="ржирзНржпрзВржирждржо рж╕рзАржорж╛ ржЕржирзБрж╕рж░ржг ржХрж░рзБржи" style="width:100%; padding:12px; border-radius:10px; border:1px solid var(--border-light); font-size:0.95rem;">
        </div>
        <button type="submit" id="withdraw-submit-btn" class="action-btn" style="width:100%; margin-top:6px; border-radius:10px; font-weight:700; font-size:1rem;">ржЕржирзБрж░рзЛржз ржЬржорж╛ ржжрж┐ржи</button>
        <p style="font-size:0.85rem; text-align:center; margin-top:15px; opacity:0.8;">
          <b>ржирзЛржЯ:</b> ржЕржирзБрж░рзЛржз ржЬржорж╛ ржжрзЗржУрзЯрж╛рж░ ржкрж░ рзирзк ржШржирзНржЯрж╛рж░ ржоржзрзНржпрзЗ рж░рж┐ржнрж┐ржЙ рж╕ржорзНржкржирзНржи рж╣ржмрзЗред
        </p>
      </form>`;
  };

  const renderDynamicLinks = () => {
    const container = document.getElementById('dynamic-links-container'); container.innerHTML = '';
    if (appConfig.links) {
      const links = [];
      for (const key in appConfig.links) { links.push({key, ...appConfig.links[key]}); }
      links.reverse();
      links.forEach(link => {
        const el = document.createElement('div'); el.className = 'task-container';
        el.innerHTML = `
          <img class="task-icon-img" src="${link.icon}" alt="icon" style="width:48px;height:48px;border-radius:12px;object-fit:cover;border:2px solid var(--primary-color);box-shadow:0 2px 6px rgba(0,0,0,0.08);">
          <div class="task-info" style="flex-grow:1;">
            <h3 style="font-size:1.05rem;font-weight:700;margin-bottom:4px;color:var(--primary-color);">${link.name}</h3>
            <p style="font-size:0.9rem;opacity:0.8;">ржЖрж░ржУ ржЬрж╛ржирждрзЗ ржмрж╛ ржПржХрзНрж╕ржкрзНрж▓рзЛрж░ ржХрж░рждрзЗ ржХрзНрж▓рж┐ржХ ржХрж░рзБржи</p>
          </div>
          <button class="action-btn" onclick="window.Telegram.WebApp.openLink('${link.url}')" style="padding:10px 18px;border-radius:10px;font-weight:700;font-size:0.9rem;box-shadow:0 2px 10px rgba(231,76,60,0.25);">ЁЯМР ржнрж┐ржЬрж┐ржЯ</button>`;
        container.appendChild(el);
      });
    }
  };

  initApp();
});
</script> -->
</body>
</html>